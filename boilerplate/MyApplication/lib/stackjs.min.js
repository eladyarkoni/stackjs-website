(function(){var Defaults={defaultObjectName:"STObject",extendsSeperator:"::",stackSize:100,viewPlaceholder:"$$",enableCollector:true};var _classes={};var _sharedObjects={};var _exceptionCallbacks={};var _globalsObject=typeof window!=="undefined"?window:global;var report=function(text){var date=new Date;console.log("STACKJS: "+date.toString()+" : "+text)};var parseClassName=function(classStr){var classNameArray=classStr.split(Defaults.extendsSeperator);var className=classNameArray[0];var extend=classNameArray[1];
return{name:className,extend:extend}};var getterMethodBuilder=function(name,originalProperty){return function(){Stack.push(name,this,originalProperty);var retValue=this[originalProperty];Stack.pop();return retValue}};var setterMethodBuilder=function(name,originalProperty){return function(object){Stack.push(name,this,originalProperty);this[originalProperty]=object;Stack.pop()}};var classMethodBuilder=function(name,originalProperty){var myFunction=this[originalProperty];return function(object){Stack.push(name,
this,originalProperty);var retValue=myFunction.apply(this,arguments);Stack.pop();return retValue}};var getGetterSetterName=function(action,propertyName){return action+propertyName.charAt(0).toUpperCase()+propertyName.slice(1)};var Stack={stack:[],push:function(className,objectRef,methodName){if(Defaults.stackSize==this.stack.length)this.stack.shift();this.stack.push({className:className,methodName:methodName})},pop:function(){return this.stack.pop()},clear:function(){this.stack=[]},printStackTrace:function(exceptionObject){var traceStr=
"";for(var i=0;i<this.stack.length;i++){var stackObect=this.stack[i];traceStr+=stackObect.className+" : "+stackObect.methodName+" -> "}traceStr+=exceptionObject.toString();report(traceStr)}};var Throw=function(exceptionObject){if(typeof _exceptionCallbacks[exceptionObject._class]!=="undefined")_exceptionCallbacks[exceptionObject._class](exceptionObject);else{Stack.printStackTrace(exceptionObject);Stack.clear()}};var Catch=function(exceptionName,callback){_exceptionCallbacks[exceptionName]=callback};
var Class=function(name,data){var classNameObject=parseClassName(name);name=classNameObject.name;var extendsClassName=classNameObject.extend;if(typeof extendsClassName==="undefined")extendsClassName=Defaults.defaultObjectName;var extendedClasses=[];var extendsTemp=extendsClassName;while(extendsTemp!==Defaults.defaultObjectName){extendedClasses.push(extendsTemp);extendsTemp=_classes[extendsTemp].prototype._extends}extendedClasses.reverse();var classPropertiesAnnotations={};for(var property in data)if(property.charAt(0)===
"@"){var matches=property.match(/(\w+)\s*\(\s*(\w+)\s*\)/);var propName=matches[2];var annotationName=matches[1];var annotation={annotation:annotationName,value:data[property]};classPropertiesAnnotations[propName]=annotation}_classes[name]=function(){if(this.constructor!==_classes[name]){if(typeof _sharedObjects[name]==="undefined")_sharedObjects[name]=new _classes[name];return _sharedObjects[name]}if(typeof extendedClasses!=="undefined")for(var i=0;i<extendedClasses.length;i++)if(typeof this[extendedClasses[i]]!==
"undefined")this[extendedClasses[i]].apply(this,arguments);if(typeof this[name]!=="undefined")this[name].apply(this,arguments)};for(var proto in _classes[extendsClassName].prototype)if(proto.charAt(0)!=="_"&&proto.charAt(0)!=="@")_classes[name].prototype[proto]=_classes[extendsClassName].prototype[proto];var propertyName;for(propertyName in data)if(typeof data[propertyName]!=="function"){var getterName=getGetterSetterName("get",propertyName);var setterName=getGetterSetterName("set",propertyName);
if(typeof data[getterName]!=="function"&&propertyName.charAt(0)!=="_"&&propertyName.charAt(0)!=="@")data[getterName]=getterMethodBuilder.apply(data,[name,propertyName]);if(typeof data[setterName]!=="function"&&propertyName.charAt(0)!=="_"&&propertyName.charAt(0)!=="@")data[setterName]=setterMethodBuilder.apply(data,[name,propertyName])}else data[propertyName]=classMethodBuilder.apply(data,[name,propertyName]);for(propertyName in data)_classes[name].prototype[propertyName]=data[propertyName];_classes[name].prototype["_extends"]=
extendsClassName;_classes[name].prototype["_extendsList"]=extendedClasses;_classes[name].prototype["_class"]=name;_classes[name].prototype["_annotations"]=classPropertiesAnnotations;_globalsObject[name]=_classes[name]};Class(Defaults.defaultObjectName,{delegate:null,isExtends:function(classStr){for(var i=0;i<this._extendsList.length;i++)if(this._extendsList[i]===classStr)return true;return false},callDelegate:function(methodName,params){if(this.delegate!==null&&typeof this.delegate[methodName]!==
"undefined")this.delegate[methodName].apply(this.delegate,params)},clone:function(){return Object.create(this)}});Class("Exception",{message:null,Exception:function(message){this.message=message},toString:function(){return this._class+": "+this.message+" "}});Class("MissingAnnotationException::Exception",{MissingAnnotationException:function(annotationName){this.message=annotationName+" annotation is missing"}});Class("InvalidParameterException::Exception",{InvalidParameterException:function(expectedType,
parameterIndex){this.message="parameter "+parameterIndex+" should be "+expectedType}});Class("UnsupportedOperationException::Exception",{UnsupportedOperationException:function(methodName){this.message=methodName+" method is not implemented yet"}});Class("DeprecatedException::Exception",{DeprecatedException:function(oldMethod,newMethod){this.message="Method "+oldMethod+" is deprecated, please use "+newMethod+" instead"}});Class("View",{element:null,controller:null,model:null,elementType:"div",elementClass:"view",
View:function(){this.element=document.createElement(this.elementType);this.element.className=this.elementClass},addClasses:function(){this.element.className="";for(var i=0;i<arguments.length;i++)this.element.className+=arguments[i]+" "},getViews:function(selector){return this.element.querySelector(selector)},addViews:function(template){var ph=Defaults.viewPlaceholder;for(var k=1;k<arguments.length;k++)if(arguments[k]!==null)if(typeof arguments[k]==="string"||typeof arguments[k]==="boolean"||typeof arguments[k]===
"number")template=template.replace(ph,arguments[k]);else if(arguments[k].isExtends("View")||arguments[k]._class==="View")template=template.replace(ph,"<div class='view-placeholder'></div>");var elementHandler=document.createElement("div");elementHandler.innerHTML=template;for(var i=1;i<arguments.length;i++)if(arguments[i]!==null)if(arguments[i].isExtends&&(arguments[i].isExtends("View")||arguments[i]._class==="View")){var view=arguments[i];if(typeof this.delegate!=="undefined"&&view.delegate===null&&
this.delegate!==null&&this._class!=="Viewport")view.setDelegate(this.delegate);if(typeof this.model!=="undefined"&&view.model===null&&this.model!==null&&this._class!=="Viewport")view.setModel(this.model);view.render();var replacableNode=elementHandler.querySelector(".view-placeholder");var replacableParentNode=replacableNode.parentNode;replacableParentNode.appendChild(view.element);replacableParentNode.removeChild(replacableNode)}if(elementHandler.hasChildNodes())while(elementHandler.childNodes.length>=
1)this.element.appendChild(elementHandler.firstChild)},clearViews:function(){var cell=this.element;if(cell.hasChildNodes())while(cell.childNodes.length>=1)cell.removeChild(cell.firstChild)},removeView:function(){this.element.parentNode.removeChild(this.element)},addEvent:function(selector,eventType,eventName,preventDefault){var _self=this;preventDefault=typeof preventDefault==="undefined"?false:preventDefault;var eventCallback=function(){return function(evt){if(preventDefault)evt.preventDefault();
_self.handleEvents.apply(_self,[evt,eventName])}}.apply(_self);var elements=this.element.querySelectorAll(selector);if(elements.length===0)elements=[this.element];for(var i=0;i<elements.length;i++)elements[i][eventType]=eventCallback},handleEvents:function(eventObject,eventName){Throw(new UnsupportedOperationException("handleEvents"))},render:function(){return this.element}});Class("Viewport::View",{width:typeof window!=="undefined"?window.innerWidth:0,height:typeof window!=="undefined"?window.innerHeight:
0,init:function(delegate){this.delegate=delegate;this.element=document.body;this.start()},start:function(){var _self=this;if(document.addEventListener)window.addEventListener("load",function(){_self.callDelegate("didBecomeActive",[_self])},false);else window.attachEvent("onload",function(){_self.callDelegate("didBecomeActive",[_self])});document.body.onbeforeunload=function(){_self.callDelegate("willResignActive")};document.body.onunload=function(){_self.callDelegate("willTerminate")}}});_globalsObject.Class=
Class;_globalsObject.Throw=Throw;_globalsObject.Catch=Catch})();